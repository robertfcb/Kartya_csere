<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cserekártya Nézegető</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f0f4f8; }
        .card-viewer { min-height: 400px; }
        
        /* A kép kitölti a területet, de nem vágja le a szélét. */
        #card-image { object-fit: contain !important; }
        /* Modern betűtípus a logóhoz */
        .modern-font { font-family: 'Inter', sans-serif; letter-spacing: 0.1em; }

        /* KONFETTI/HÓPEHELY ANIMÁCIÓ STÍLUSOK (CSAK A KEZDŐKÉPERNYŐN LÁTHATÓ) */
        .confetti-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 5;
        }
        .confetti {
            position: absolute;
            width: 8px;
            height: 8px;
            background-color: transparent;
            border-radius: 50%;
        }
        /* A pehely megáll a konténer alján (kb. 15px távolságra) */
        @keyframes fall {
            from { top: -10px; } 
            to { top: calc(100% - 15px); }
        }
        
        /* MOBIL NÉZET STÍLUSOK */
        @media (max-width: 767px) {
            /* 1. Menü elrejtése alapértelmezésben */
            #mobile-menu-wrapper {
                position: fixed; /* Fix pozíció, hogy felülírja a flex elrendezést */
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                z-index: 40; /* Magasan legyen */
                background-color: rgba(240, 244, 248, 0.95); /* Átlátszó háttér */
                padding: 1rem;
                display: none; /* Rejtett alapértelmezésben */
                overflow-y: auto;
            }

            /* Menü, ha látható */
            #mobile-menu-wrapper.show {
                display: block;
            }

            /* 2. Lebegő gomb */
            #mobile-menu-toggle {
                position: fixed;
                top: 1.5rem; /* FEL FELSŐ SAROK */
                left: 1.5rem; /* BAL FELSŐ SAROK */
                bottom: auto; /* Eltávolítva a bottom pozíció */
                right: auto; /* Eltávolítva a right pozíció */
                z-index: 50;
                display: block;
            }
            
            /* JAVÍTVA: Balra igazítjuk a gombokat mobilon is */
            #mobile-menu-wrapper .filter-button {
                max-width: 90%; /* Kicsit szélesebbre állítva */
                margin-left: 0; /* Balra igazítva */
                margin-right: auto;
                text-align: left !important; /* Balra igazítva */
            }
            
            /* A klub lenyíló menü gombjainak igazítása (a behúzás eltávolítása) */
            #mobile-menu-wrapper #club-dropdown-menu .filter-button {
                padding-left: 1rem; 
            }

            /* A klubok fő gombjának szöveg igazítása */
            #club-main-button {
                 text-align: left !important; /* Balra igazítva */
                 max-width: 90%;
                 margin-left: 0;
                 margin-right: auto;
            }
            
            /* Maga a menü konténer középre van igazítva, de a gombok balra vannak igazítva a konténerükben */
            #mobile-menu-wrapper aside {
                max-width: 350px;
                margin-left: auto;
                margin-right: auto;
            }
        }
        
        /* ASZTALI NÉZET STÍLUSOK (megjelenik a menü, eltűnik a gomb) */
        @media (min-width: 768px) {
            #mobile-menu-toggle {
                display: none !important; 
            }
        }

        /* ÚJ STÍLUS: A lenyíló klubmenü a gombon belül marad, lefelé nyílik */
        #club-dropdown-menu {
            position: static; 
            width: 100%;
            margin-top: 0;
            margin-left: 0;
            background-color: #f8f8f8; 
            border: none;
            box-shadow: none;
            padding: 0.5rem 0;
            border-radius: 0 0 8px 8px;
            max-height: 250px; 
        }
        #club-dropdown-menu li {
            padding: 0;
        }
        #club-dropdown-menu .filter-button {
            padding-left: 1.5rem; 
            font-weight: 400; 
        }

    </style>
</head>
<body class="text-[#073B4C] min-h-screen">

    <!-- 3. MOBIL LEBEGŐ MENÜ GOMB -->
    <button id="mobile-menu-toggle" 
            class="bg-[#118AB2] text-white p-4 rounded-full shadow-2xl transition-all hover:bg-[#FF6B6B] focus:outline-none focus:ring-4 focus:ring-[#118AB2] focus:ring-opacity-50">
        <!-- Unicode Ikon a menünek (Hamburger) -->
        <span id="toggle-icon" class="text-2xl">☰</span>
    </button>
    <!-- END MOBIL GOMB -->

    <div class="container mx-auto p-4 md:p-8">
        
        <!-- ÚJ FLEX CONTAINER: OLDALSÁV + FŐ TARTALOM -->
        <div class="flex flex-col md:flex-row gap-8">
            
            <!-- 1. BAL OLDALI MENÜSÁV (ASIDE) -->
            <!-- Mobilon a menü rejtett, csak a gomb hívja elő -->
            <div id="mobile-menu-wrapper" class="md:w-64 w-full">
                <aside class="md:w-64 w-full bg-white rounded-xl shadow-2xl p-4 md:p-6 md:sticky md:top-8 md:h-[calc(100vh-64px)] md:overflow-y-auto">
                    <!-- Fő Cím beillesztve az oldalsáv tetejére -->
                    <header class="text-center mb-6">
                        <h1 class="text-2xl font-extrabold text-[#118AB2]">CSERE KÁRTYÁK</h1>
                        <p class="mt-1 text-sm text-gray-600">Lapozható lista</p>
                    </header>

                    <nav>
                        <h3 class="text-lg font-bold text-[#FF6B6B] mb-4 border-b pb-2 border-gray-200">Kategóriák</h3>
                        
                        <!-- Kategória gombok generálása JS-ből -->
                        <div id="category-filter" class="flex flex-col gap-2">
                            <!-- JS GENERATED BUTTONS GO HERE -->
                        </div>
                    </nav>
                </aside>
            </div>

            <!-- 2. FŐ TARTALOM / KÁRTYA NÉZEGETŐ (MAIN) -->
            <main class="md:flex-1">
                <div id="card-viewer-container" class="bg-white rounded-xl shadow-2xl p-6 card-viewer flex flex-col items-center justify-between">
                    
                    <!-- Kezdőképernyő / Kártya adatok -->
                    <div id="card-display-area" class="w-full max-w-xl text-center">
                        
                        <!-- Semleges kezdőképernyő tartalom (Default View) -->
                        <div id="welcome-screen" class="p-8 relative">
                            
                            <!-- KONFETTI CONTAINER -->
                            <div id="confetti-effect" class="confetti-container"></div>
                            <!-- END KONFETTI -->

                            <!-- FŐ TARTALOM (Z-INDEX 10-ZEL) -->
                            <div class="relative z-10">
                                
                                <!-- Frissített logó és felirat -->
                                <h2 class="text-5xl md:text-6xl font-extrabold text-[#073B4C] modern-font mb-2 tracking-tighter relative z-10">
                                    PANINI ADRENALYN
                                </h2>
                                <p class="4xl font-black text-[#FF6B6B] modern-font mb-6 tracking-widest relative z-10">
                                    XL <span class="text-[#06D6A0]">2026</span>
                                </p>
                                
                                <!-- BANNER HELY MOBILRA BEILLESZTVE -->
                                <div id="banner-container-mobile" class="mt-4 mb-4">
                                    <div class="bg-gray-100 p-2 rounded-lg shadow-sm text-center max-w-lg mx-auto">
                                        <img src="https://i.imgur.com/tNTULFh.jpeg" 
                                             alt="Banner kép helykitöltő" 
                                             class="w-full h-auto max-h-24 object-cover rounded-md mx-auto"
                                             onerror="this.onerror=null;this.src='https://placehold.co/700x120/073B4C/FFFFFF?text=Kép+Nem+Elérhető'">
                                    </div>
                                </div>
                                <!-- END BANNER HELY MOBILRA -->

                                <p class="mt-2 text-md text-gray-500 relative z-10">
                                    A csere kártyákat kategóriákra bontva találod a menüben. A hiányzó kártyáimat külön menüben találod.
                                </p>

                                <!-- Kapcsolatfelvételi szöveg -->
                                <p class="mt-12 text-md md:text-lg font-semibold text-[#FF6B6B] modern-font relative z-10">
                                    Minden csere kártya hibátlan állapotban, védőtasakban van.
                                    <br>
                                    
                                </p>
                                <!-- END ÚJ -->
                            </div>
                        </div>
                        
                        <!-- HIÁNYZÓ KÁRTYÁK NÉZET -->
                        <div id="missing-cards-view" class="hidden text-left max-w-full mx-auto p-4 md:p-8">
                            <h2 class="text-3xl font-extrabold text-[#073B4C] modern-font mb-2 tracking-tighter">
                                PANINI ADRENALYN
                            </h2>
                            <p class="text-2xl font-black text-[#FF6B6B] modern-font mb-6 tracking-widest">
                                XL <span class="text-[#06D6A0]">2026</span>
                            </p>
                            <h3 class="text-xl font-bold text-[#118AB2] mb-4">Hiányzó Lapok Részletes Listája</h3>
                            <div id="missing-cards-list" class="space-y-4">
                                <!-- JS generálja ide a hiányzó lapokat -->
                            </div>
                        </div>
                        <!-- END HIÁNYZÓ KÁRTYÁK NÉZET -->


                        <!-- Kártya megjelenítés (Filtered View - Rejtve indításkor) -->
                        <div id="filtered-card-view" class="hidden">
                            <p id="current-category" class="text-xl font-bold text-[#FF6B6B] mb-4 uppercase"></p>
                            <div class="relative w-full h-80 bg-gray-200 rounded-lg overflow-hidden shadow-xl mb-4 mx-auto max-w-[300px]">
                                <img id="card-image" class="w-full h-full transition-opacity duration-300" 
                                    src="https://placehold.co/300x400/06D6A0/073B4C?text=Cserek%C3%A1rtya+Fot%C3%B3" 
                                    onerror="this.onerror=null;this.src='https://placehold.co/300x400/06D6A0/073B4C?text=K%C3%A9p+Nem+El%C9%A5rhet%C5%90'">
                            </div>
                            
                            <h2 id="card-name" class="3xl font-extrabold text-[#073B4C] my-2">Kártya Neve</h2>
                            <p class="text-lg font-semibold text-[#118AB2]">Sorszám: <span id="card-number" class="text-[#073B4C]">00</span></p>
                            <p class="text-md text-gray-500">Csapat: <span id="card-team">Nincs Adat</span></p>
                        </div>
                    </div>

                    <!-- Lapozó gombok (Rejtve indításkor) -->
                    <div id="pagination-controls" class="hidden flex justify-between w-full max-w-xl mt-6">
                        <button id="prev-button" 
                                class="bg-[#FFD166] text-[#073B4C] font-bold py-3 px-6 rounded-full shadow-lg transition-all hover:bg-[#FF6B6B] hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed">
                            &larr; Előző
                        </button>
                        
                        <p id="card-counter" class="text-xl font-bold self-center text-[#118AB2]"></p>

                        <button id="next-button" 
                                class="bg-[#FFD166] text-[#073B4C] font-bold py-3 px-6 rounded-full shadow-lg transition-all hover:bg-[#06D6A0] hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed">
                            Következő &rarr;
                        </button>
                    </div>
                </div>
                
                <!-- A korábban itt lévő banner konténer is eltávolítva -->

            </main>
        </div>
    </div>

<script>
    
    // A KÁRTYÁK KATEGÓRIÁI ÉS A KLUBNEVEK MOST MÁR KÜLÖN SZŰRŐDNEK!

    const MISSING_CARDS_DATA = {
        "World Cup": "5, 6, 8, 12, 17, 18, 21, 23, 25, 31, 32, 34, 35",
        "Elite kártyák": "1, 2, 4, 7, 10, 18",
        "Fans' favourite kártyák": "3, 5, 6, 13, 16, 19, 20, 21, 24, 25, 27, 28, 29, 38, 40, 43, 44, 45, 51, 55, 56, 58, 60, 61, 64, 66, 67, 71, 73, 74, 79, 80, 92, 97",
        "Botafogo": "3, 10, 13",
        "Frankfurt": "1, 5, 11, 13, 16, 17",
        "Liverpool": "6, 9, 10, 11, 12, 13, 14",
        "Olympiacos": "13, 18",
        "Marseille": "5, 18",
        "Inter": "1, 2, 3, 7, 14",
        "Paris": "1, 3, 7, 13, 14, 16",
        "Milan": "3, 4, 5, 6, 12",
        "Leverkusen": "2, 5, 7, 10, 11, 13, 14, 18",
        "Ajax": "10, 11",
        "PSV": "3, 4, 6, 8, 10, 16, 17, 18",
        "Sporting": "6, 9, 15",
        "Al Nassr": "1, 7, 8, 9, 11, 13",
        "Atletico Madrid": "2, 4",
        "Barcelona": "1, 12, 15, 16",
        "Real Madrid": "5, 8, 12, 13, 15"
    };

    const swapCardsData = [
        // Ide illeszd be a kártya adataidat! FONTOS: vesszővel válaszd el az elemeket, és az utolsó után NE tegyél vesszőt!
        
        // KÜLÖNLEGES KÁRTYÁK MINTÁI
        { category: "World Cup", name: "WC Lap 1 (Minta)", number: 40, team: "Brazil", img: "https://placehold.co/300x400/118AB2/ffffff?text=World+Cup+40", isClub: false },
        { category: "World Cup", name: "WC Lap - Harry Kane", number: 12, team: "England", img: "https://placehold.co/300x400/118AB2/ffffff?text=WC+England+12", isClub: false },
        { category: "Elite kártyák", name: "Cristiano Ronaldo", number: 19, team: "Al Nassr", img: "https://placehold.co/300x400/FF6B6B/ffffff?text=Elite+Ronaldo", isClub: false },
        { category: "Fans' favourite kártyák", name: "Fan Fav Lap A", number: 98, team: "Best Player A", img: "https://placehold.co/300x400/FFD166/073B4C?text=Fan+Fav+98", isClub: false },
        { category: "Golden Baller", name: "Golden Baller Lap", number: 1, team: "Messi", img: "https://placehold.co/300x400/FFD166/073B4C?text=Golden+Baller+1", isClub: false },
        
        // PARALEL KÁRTYÁK MINTÁI
        { category: "Kék paralel", name: "Kék Paralel Lap", number: 55, team: "Chelsea", img: "https://placehold.co/300x400/118AB2/ffffff?text=K%C3%A9k+Paralel+55", isClub: false },
        { category: "Piros paralel", name: "Piros Paralel Lap", number: 66, team: "Arsenal", img: "https://placehold.co/300x400/FF6B6B/ffffff?text=Piros+Paralel+66", isClub: false },
        { category: "Rózsaszín paralel", name: "Rózsaszín Paralel Lap", number: 77, team: "PSG", img: "https://placehold.co/300x400/FF6B6B/ffffff?text=R%C3%B3zsasz%C3%ADn+77", isClub: false },
        
        // KLUB KÁRTYÁK MINTÁI (isClub: true)
        { category: "Klub Kártyák", name: "Leverkusen Lap 1", number: 10, team: "Leverkusen", img: "https://placehold.co/300x400/06D6A0/073B4C?text=Leverkusen+10", isClub: true },
        { category: "Klub Kártyák", name: "PSV Lap 1", number: 5, team: "PSV", img: "https://placehold.co/300x400/118AB2/ffffff?text=PSV+5", isClub: true },
        { category: "Klub Kártyák", name: "Liverpool Lap 1", number: 6, team: "Liverpool", img: "https://placehold.co/300x400/FF6B6B/ffffff?text=Liverpool+6", isClub: true },
        { category: "Klub Kártyák", name: "Frankfurt Lap 1", number: 1, team: "Frankfurt", img: "https://placehold.co/300x400/FFD166/073B4C?text=Frankfurt+1", isClub: true },
        { category: "Klub Kártyák", name: "Paris Lap 1", number: 1, team: "Paris", img: "https://placehold.co/300x400/06D6A0/073B4C?text=Paris+1", isClub: true },
        { category: "Klub Kártyák", name: "Al Nassr Lap 1", number: 1, team: "Al Nassr", img: "https://placehold.co/300x400/118AB2/ffffff?text=Al+Nassr+1", isClub: true },
        { category: "Klub Kártyák", name: "Inter Lap 1", number: 1, team: "Inter", img: "https://placehold.co/300x400/FF6B6B/ffffff?text=Inter+1", isClub: true },
        { category: "Klub Kártyák", name: "Milan Lap 1", number: 3, team: "Milan", img: "https://placehold.co/300x400/FFD166/073B4C?text=Milan+3", isClub: true },
        { category: "Klub Kártyák", name: "Real Madrid Lap 1", number: 5, team: "Real Madrid", img: "https://placehold.co/300x400/06D6A0/073B4C?text=Real+5", isClub: true },
        { category: "Klub Kártyák", name: "Barcelona Lap 1", number: 1, team: "Barcelona", img: "https://placehold.co/300x400/118AB2/ffffff?text=Barcelona+1", isClub: true },
        { category: "Klub Kártyák", name: "Botafogo Lap 1", number: 3, team: "Botafogo", img: "https://placehold.co/300x400/FF6B6B/ffffff?text=Botafogo+3", isClub: true },
        { category: "Klub Kártyák", name: "Sporting Lap 1", number: 6, team: "Sporting", img: "https://placehold.co/300x400/FFD166/073B4C?text=Sporting+6", isClub: true },
        { category: "Klub Kártyák", name: "Olympiacos Lap 1", number: 13, team: "Olympiacos", img: "https://placehold.co/300x400/06D6A0/073B4C?text=Olympiacos+13", isClub: true },
        { category: "Klub Kártyák", name: "Marseille Lap 1", number: 5, team: "Marseille", img: "https://placehold.co/300x400/118AB2/ffffff?text=Marseille+5", isClub: true },
        { category: "Klub Kártyák", name: "Ajax Lap 1", number: 10, team: "Ajax", img: "https://placehold.co/300x400/FF6B6B/ffffff?text=Ajax+10", isClub: true },
        { category: "Klub Kártyák", name: "Atletico Madrid Lap 1", number: 2, team: "Atletico Madrid", img: "https://placehold.co/300x400/FFD166/073B4C?text=Atletico+2", isClub: true }
    ];

    let currentCategory = null; // null-ra állítva a kezdőképernyő miatt
    let currentCardIndex = 0;
    let filteredCards = [];

    // Külön definiáljuk a strukturált kategóriákat, hogy a gombfrissítésnél is elérhető legyen.
    let structuredCategories = {}; 

    const elements = {
        filterContainer: document.getElementById('category-filter'),
        cardImage: document.getElementById('card-image'),
        cardName: document.getElementById('card-name'),
        cardNumber: document.getElementById('card-number'),
        cardTeam: document.getElementById('card-team'),
        currentCategoryEl: document.getElementById('current-category'),
        cardCounter: document.getElementById('card-counter'),
        prevButton: document.getElementById('prev-button'),
        nextButton: document.getElementById('next-button'),
        welcomeScreen: document.getElementById('welcome-screen'),
        filteredCardView: document.getElementById('filtered-card-view'),
        paginationControls: document.getElementById('pagination-controls'),
        confettiEffect: document.getElementById('confetti-effect'),
        mobileMenuWrapper: document.getElementById('mobile-menu-wrapper'),
        mobileMenuToggle: document.getElementById('mobile-menu-toggle'),
        toggleIcon: document.getElementById('toggle-icon'),
        missingCardsView: document.getElementById('missing-cards-view'),
        missingCardsList: document.getElementById('missing-cards-list')
    };

    const HUNGARIAN_COLORS = ['#FF6B6B', '#FFFFFF', '#06D6A0'];

    let confettiInterval;

    function startConfetti() {
        stopConfetti(); 

        const container = elements.confettiEffect;
        
        function createConfetti() {
            const confetti = document.createElement('div');
            confetti.classList.add('confetti');

            const color = HUNGARIAN_COLORS[Math.floor(Math.random() * HUNGARIAN_COLORS.length)];
            confetti.style.backgroundColor = color === '#FFFFFF' ? 'rgba(255, 255, 255, 0.7)' : color;
            
            const startX = Math.random() * container.offsetWidth;
            const size = Math.random() * 8 + 4;
            const duration = Math.random() * 5 + 7;

            confetti.style.left = startX + 'px';
            confetti.style.width = size + 'px';
            confetti.style.height = size + 'px';
            
            confetti.style.animation = `fall ${duration}s linear forwards`; 
            
            container.appendChild(confetti);
        }

        confettiInterval = setInterval(createConfetti, 500); 
    }

    function stopConfetti() {
        if (confettiInterval) {
            clearInterval(confettiInterval);
            confettiInterval = null;
        }
    }


    // ÚJ FÜGGVÉNY: Strukturált kategóriákat ad vissza a menü építéséhez.
    function getStructuredCategories() {
        const clubNames = Array.from(new Set(swapCardsData
            .filter(card => card.isClub)
            .map(card => card.team)
        )).sort();

        const specialCategories = Array.from(new Set(swapCardsData
            .filter(card => !card.isClub)
            .map(card => card.category)
        )).filter(cat => cat !== 'Klub Kártyák').sort();

        structuredCategories = {
            regular: ['Kezdőoldal', 'Hiányzó Kártyák', ...specialCategories], // 'Összes kártya' eltávolítva
            clubs: clubNames
        };
        return structuredCategories;
    }

    // ÚJ FÜGGVÉNY: Kezeli a mobil menü megjelenítését/elrejtését.
    function toggleMobileMenu(show) {
        if (window.innerWidth >= 768) return; // Asztali gépen ne csináljon semmit

        if (show === true || elements.mobileMenuWrapper.classList.contains('show') === false) {
            elements.mobileMenuWrapper.classList.add('show');
            elements.toggleIcon.textContent = '✕'; // Ikon váltás Bezárásra
        } else {
            elements.mobileMenuWrapper.classList.remove('show');
            elements.toggleIcon.textContent = '☰'; // Ikon váltás Menüre
        }
    }
    
    // Eseménykezelő a mobil gombhoz
    elements.mobileMenuToggle.addEventListener('click', () => {
        toggleMobileMenu();
    });
    
    // HIÁNYZÓ LAPOK LISTÁJÁNAK GENERÁLÁSA
    function renderMissingCards() {
        const listContainer = elements.missingCardsList;
        listContainer.innerHTML = '';
        
        let htmlContent = '';
        
        const clubCategories = ["Botafogo", "Frankfurt", "Liverpool", "Olympiacos", "Marseille", "Inter", "Paris", "Milan", "Leverkusen", "Ajax", "PSV", "Sporting", "Al Nassr", "Atletico Madrid", "Barcelona", "Real Madrid"];

        // 1. Különleges kártyák
        for (const [category, numbers] of Object.entries(MISSING_CARDS_DATA)) {
            if (!clubCategories.includes(category)) {
                const count = (numbers.match(/\d+/g) || []).length;
                htmlContent += `
                    <div class="p-3 bg-[#f8f8f8] rounded-lg shadow-sm border border-gray-200">
                        <h4 class="text-lg font-semibold text-[#FF6B6B]">${category} (${count} db)</h4>
                        <p class="text-gray-700 break-words mt-1">${numbers}</p>
                    </div>
                `;
            }
        }
        
        // 2. Klubok rész
        htmlContent += '<h4 class="text-xl font-bold text-[#118AB2] mt-6 mb-3 border-t pt-4 border-gray-300">Klubok (Csapatok)</h4>';
        
        for (const club of clubCategories) {
            if (MISSING_CARDS_DATA[club]) {
                const numbers = MISSING_CARDS_DATA[club];
                const count = (numbers.match(/\d+/g) || []).length;
                htmlContent += `
                    <div class="p-3 bg-[#f8f8f8] rounded-lg shadow-sm border border-gray-200">
                        <h4 class="text-lg font-semibold text-[#06D6A0]">${club} (${count} db)</h4>
                        <p class="text-gray-700 break-words mt-1">${numbers}</p>
                    </div>
                `;
            }
        }
        
        listContainer.innerHTML = htmlContent;
    }


    // FÜGGVÉNY: Kezeli a szűrést
    function filterCards(filterValue) {
        
        // Bezárja a klubmenüt, ha nem a klubgombon kattintottak
        const dropdownMenuEl = document.getElementById('club-dropdown-menu');
        if (dropdownMenuEl) {
             // Nem zárja be automatikusan, mivel az alapértelmezett állapot a nyitott
        }
        
        // **MOBIL JAVÍTÁS:** Zárjuk be a menüt minden kategóriaválasztásnál
        if (window.innerWidth < 768) {
            toggleMobileMenu(false); 
        }

        // Nézet váltása
        elements.welcomeScreen.classList.add('hidden');
        elements.filteredCardView.classList.add('hidden');
        elements.paginationControls.classList.add('hidden');
        elements.missingCardsView.classList.add('hidden'); // Alapértelmezetten rejtjük

        if (filterValue === 'Kezdőoldal') {
            currentCategory = 'Kezdőoldal';
            filteredCards = [];
            
            // Közvetlen visszaugrás a kezdőlapra
            elements.welcomeScreen.classList.remove('hidden');
            
            updateFilterButtons(filterValue);
            startConfetti();
            return;
        }

        if (filterValue === 'Hiányzó Kártyák') {
             currentCategory = 'Hiányzó Kártyák';
             renderMissingCards();
             elements.missingCardsView.classList.remove('hidden'); // Megjelenítjük a hiányzó lapok nézetet
             stopConfetti();
             updateFilterButtons(filterValue);
             return;
        }
        
        if (filterValue === 'Összes kártya') {
            filteredCards = swapCardsData;
        } else {
            // Szűrés kategóriára VAGY csapatnévre
            filteredCards = swapCardsData.filter(card => 
                card.category === filterValue || card.team === filterValue
            );
        }
        
        currentCardIndex = 0;
        currentCategory = filterValue;
        
        elements.filteredCardView.classList.remove('hidden');
        elements.paginationControls.classList.remove('hidden');
        
        stopConfetti();
        updateCardDisplay();
        updateFilterButtons(filterValue);
    }

    // HELPER: Létrehoz egy gombot
    function createButton(text, filterValue, additionalClasses = '') {
        const button = document.createElement('button');
        // JAVÍTVA: text-left hozzáadva a gombokhoz az asztali igazításhoz
        button.className = `filter-button text-sm font-semibold py-1.5 px-3 rounded-lg transition-colors duration-200 whitespace-nowrap w-full text-left ${additionalClasses}`;
        button.dataset.category = filterValue;
        button.textContent = text;
        button.addEventListener('click', () => filterCards(filterValue));
        return button;
    }

    // FÜGGVÉNY: Frissíti a gombok stílusát az aktív kategória alapján
    function updateFilterButtons(activeCategory) {
        const categoryToActivate = activeCategory === null ? 'Kezdőoldal' : activeCategory; 
        const isClubSelected = structuredCategories.clubs.includes(categoryToActivate);
        
        // Gombok frissítése
        document.querySelectorAll('.filter-button').forEach(button => {
            // Alap stílus
            button.classList.remove('bg-[#118AB2]', 'text-white', 'shadow-md', 'bg-[#FF6B6B]'); // Piros eltávolítva
            
            if (button.dataset.category === 'Hiányzó Kártyák') {
                 button.classList.add('bg-[#FF6B6B]', 'text-white', 'hover:bg-[#FF6B6B]80');
                 if (button.dataset.category === categoryToActivate) {
                     button.classList.add('shadow-md', 'ring-2', 'ring-[#FFD166]'); // Aktív piros kiemelés
                 } else {
                     button.classList.remove('shadow-md', 'ring-2', 'ring-[#FFD166]');
                 }
            } else if (button.closest('ul')) {
                // Klub almenü stílusa
                button.classList.add('text-gray-700', 'hover:bg-[#FFD166]');
            } else {
                // Normál kategória stílusa
                button.classList.add('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
            }

            // Aktív stílus felülírása (normál/kezdőoldal/klub kategóriákhoz)
            if (button.dataset.category === categoryToActivate && button.dataset.category !== 'Hiányzó Kártyák') {
                button.classList.remove('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300', 'hover:bg-[#FFD166]');
                button.classList.add('bg-[#118AB2]', 'text-white', 'shadow-md');
            }
        });
        
        // KLUBOK fő gombjának vizuális frissítése, ha egy klub ki van választva
        const clubButton = document.getElementById('club-main-button');
        if (clubButton) {
            if (isClubSelected) {
                 clubButton.classList.add('bg-[#FF6B6B]', 'text-white', 'shadow-md');
                 clubButton.classList.remove('bg-gray-200', 'text-gray-700');
            } else {
                 clubButton.classList.remove('bg-[#FF6B6B]', 'text-white', 'shadow-md');
                 clubButton.classList.add('bg-gray-200', 'text-gray-700');
            }
        }
    }


    // FÜGGVÉNY: Létrehozza a menü struktúrát (speciális Klubok résszel)
    function renderFilterButtons() {
        const structured = getStructuredCategories();
        const filterContainer = elements.filterContainer;
        filterContainer.innerHTML = '';

        // 1. Normál Kategóriák (Kezdőoldal, Hiányzó Kártyák, Elite, WC)
        structured.regular.filter(cat => cat !== 'Összes kártya').forEach(category => {
            if (!category) return;
            // Különleges stílus a Hiányzó Kártyák menüponthoz
            const extraClass = category === 'Hiányzó Kártyák' ? 'bg-[#FF6B6B] text-white hover:bg-[#FF6B6B]80' : '';
            const button = createButton(category, category, extraClass);
            filterContainer.appendChild(button);
        });

        // 2. Klubok lenyíló menü (CLICK logikával)
        const clubWrapper = document.createElement('div');
        clubWrapper.id = 'club-wrapper'; 
        
        const clubButton = document.createElement('button');
        clubButton.id = 'club-main-button'; 
        clubButton.className = 'w-full text-left font-bold text-sm py-1.5 px-3 rounded-lg transition-colors duration-200 bg-gray-200 text-gray-700 hover:bg-gray-300';
        clubButton.textContent = 'Klubok ▲';
        
        const dropdownMenu = document.createElement('ul');
        dropdownMenu.id = 'club-dropdown-menu';
        dropdownMenu.className = 'w-full bg-white rounded-lg shadow-inner py-1 z-20 border-t border-gray-100 max-h-[250px] overflow-y-auto';

        clubButton.addEventListener('click', (e) => {
            e.preventDefault();
            const isHidden = dropdownMenu.classList.contains('hidden');

            if (isHidden) {
                dropdownMenu.classList.remove('hidden');
                clubButton.textContent = 'Klubok ▲';
            } else {
                dropdownMenu.classList.add('hidden');
                clubButton.textContent = 'Klubok 🔻';
            }
        });
        
        clubWrapper.appendChild(clubButton);

        structured.clubs.forEach(clubName => {
            const listItem = document.createElement('li');
            const clubFilterButton = createButton(clubName, clubName, 'text-left w-full rounded-none');
            clubFilterButton.classList.remove('py-2');
            clubFilterButton.classList.add('py-1.5');
            
            listItem.appendChild(clubFilterButton);
            dropdownMenu.appendChild(listItem);
        });

        clubWrapper.appendChild(dropdownMenu);
        filterContainer.appendChild(clubWrapper);
        
        // Kezdeti állapot beállítása
        updateFilterButtons(null);
        startConfetti();
    }

    function updateCardDisplay() {
        if (filteredCards.length === 0) {
            elements.cardImage.src = 'https://placehold.co/300x400/FF6B6B/ffffff?text=Nincs+k%C3%A1rtya';
            elements.cardName.textContent = 'Nincs elérhető kártya ebben a kategóriában.';
            elements.cardNumber.textContent = 'N/A';
            elements.cardTeam.textContent = 'N/A';
            elements.currentCategoryEl.textContent = currentCategory;
            elements.cardCounter.textContent = '0 / 0';
            elements.prevButton.disabled = true;
            elements.nextButton.disabled = true;
            return;
        }

        const card = filteredCards[currentCardIndex];
        
        elements.cardImage.style.opacity = '0'; 
        setTimeout(() => {
            elements.cardImage.classList.remove('object-cover'); 
            elements.cardImage.src = card.img;
            elements.cardImage.style.opacity = '1';
        }, 150); 
        
        elements.cardName.textContent = card.name;
        elements.cardNumber.textContent = card.number;
        elements.cardTeam.textContent = card.team;
        elements.currentCategoryEl.textContent = currentCategory;
        elements.cardCounter.textContent = `${currentCardIndex + 1} / ${filteredCards.length}`;

        elements.prevButton.disabled = currentCardIndex === 0;
        elements.nextButton.disabled = currentCardIndex === filteredCards.length - 1;
    }

    function handlePrev() {
        if (currentCardIndex > 0) {
            currentCardIndex--;
            updateCardDisplay();
        }
    }

    function handleNext() {
        if (currentCardIndex < filteredCards.length - 1) {
            currentCardIndex++;
            updateCardDisplay();
        }
    }

    elements.prevButton.addEventListener('click', handlePrev);
    elements.nextButton.addEventListener('click', handleNext);

    document.addEventListener('DOMContentLoaded', renderFilterButtons);

</script>
</body>
</html>

